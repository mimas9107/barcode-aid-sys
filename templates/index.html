<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>æ¢ç¢¼æŸ¥è©¢ç³»çµ±</title>
<style>
body { font-family: Arial; padding: 20px; }
#preview { width: 100%; border: 1px solid #333; margin-top: 10px; }
.result-box { margin-top: 20px; padding: 10px; border: 1px solid #666; background: #f8f8f8; }
</style>

<script src="https://unpkg.com/quagga/dist/quagga.min.js"></script>
</head>
<body>

<h2>ğŸ“¦ æ¢ç¢¼æŸ¥è©¢ç³»çµ±</h2>
<p>è«‹é»ä¸‹æ–¹æŒ‰éˆ•å•Ÿå‹•ç›¸æ©Ÿæƒæ Code128 æ¢ç¢¼</p>

<button onclick="startScanner()">å•Ÿå‹•ç›¸æ©Ÿæƒæ</button>

<div id="preview"></div>

<div class="result-box" id="result-box" style="display:none;">
    <h3>æŸ¥è©¢çµæœ</h3>
    <div id="result"></div>
</div>

<script>
function startScanner() {
    Quagga.init({
        inputStream : {
            name : "Live",
            type : "LiveStream",
            target: document.querySelector('#preview')
        },
        decoder : {
            readers : ["code_128_reader"]
        }
    }, function(err) {
        if (err) {
            console.error(err);
            alert("ç„¡æ³•å•Ÿå‹•ç›¸æ©Ÿï¼š" + err);
            return;
        }
        Quagga.start();
    });

    Quagga.onDetected(function(data) {
        const code = data.codeResult.code;
        Quagga.stop();
        queryAPI(code);
    });
}

function queryAPI(code) {
    const api = `/api/query?code=${encodeURIComponent(code)}`;
    fetch(api)
        .then(r => r.json())
        .then(res => {
            let html = "";
            if (res.status === "ok") {
                html += `<b>æ¢ç¢¼ï¼š</b> ${res.barcode}<br>`;
                html += `<b>å“åï¼š</b> ${res.product_name}<br>`;
                html += `<b>åº«å­˜ï¼š</b> ${res.qty}<br>`;
                html += `<b>å€‰ä½ï¼š</b> ${res.location}<br>`;
                html += `<b>ç”¨é€”ï¼š</b> ${res.usage}<br>`;
            } else {
                html = `<span style="color:red;">${res.msg}</span>`;
            }

            document.getElementById("result").innerHTML = html;
            document.getElementById("result-box").style.display = "block";
        })
        .catch(err => {
            alert("æŸ¥è©¢å¤±æ•—ï¼š" + err);
        });
}
</script>

</body>
</html>
